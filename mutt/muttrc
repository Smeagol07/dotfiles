# IMAP: offlineimap
set folder = "`echo $HOME`/Maildir"
source ~/.mutt/mailboxes
set mailcap_path=~/.mutt/mailcap
set sort=threads
# source ~/.mutt/accounts
set edit_headers = yes
set record = "+sent"
set nm_record = yes
set nm_record_tags = "-index +sent"

# Sidebar
set sidebar_visible = yes
# Ctrl-n, Ctrl-p to select next, previous folder.
# Ctrl-o to open selected folder.
bind index,pager \CP sidebar-prev
bind index,pager \CN sidebar-next
bind index,pager \CO sidebar-open

macro attach \CO '<shell-escape>rm -rf /tmp/.mutt-tmp/;mkdir /tmp/.mutt-tmp<enter><save-entry><kill-line>/tmp/.mutt-tmp/<enter>y<enter><shell-escape>xdg-open /tmp/.mutt-tmp/* 2>&1 > /dev/null<enter>'

# wrap settings
set smart_wrap
set wrap=100 # 20 ish is for sidebar
set markers=no
set wait_key=no

# notmuch
set nm_default_uri="notmuch://`echo $HOME`/Maildir" # path to the maildir
set virtual_spoolfile=yes                          # enable virtual folders
#set sendmail="/PATH/TO/bin/nm_sendmail"            # enables parsing of outgoing mail
virtual-mailboxes \
    "Inbox"   "notmuch://?query=(tag:sent or tag:inbox) and NOT tag:archive"\
    "Unread"    "notmuch://?query=tag:unread"\
    "Flagged"   "notmuch://?query=tag:flagged"\
    "Sent"      "notmuch://?query=tag:sent"\
    "Todo"      "notmuch://?query=tag:todo and NOT tag:done"\
    "Drafts"    "notmuch://?query=tag:drafts"\
    "Archive"   "notmuch://?query=tag:archive"\
    "Other"     "notmuch://?query=not tag:archive and not tag:drafts and not tag:sent and not tag:todo and not tag:* and not tag:unread and not tag:inbox" # sets up queries for


# index format
tag-transforms "inbox"   "i"   \
               "unread"  "u"   \
               "replied" "↻ "  \
               "sent"    "➥ "  \
               "todo"    "T"   \
               "archive" "A"   \
               "invites" "CAL"

tag-formats "inbox"   "GI" \
            "unread"  "GU" \
            "replied" "GR" \
            "sent"    "GS" \
            "todo"    "GT" \
            "archive" "GA" \
            "deleted" "GD" \
            "invites" "Gi"

# date-cond patch used for conditional date formating
# notmuch tags indicators for todo and archive
set index_format="%4C %Z %?GT?%GT& ?%?GA?%GA& ? %<[y?%<[m?%<[d?%[ %H:%M]&%[%a %d]>&%[%b %d]>&%[%m/%y ]> %-15.15L (%<l?%4l&%4c>) %s"

# notmuch bindings
macro pager,index \\\\ "<vfolder-from-query>"              # looks up a hand made query
macro index A "<modify-labels-then-hide>+archive\n"        # tag as Archived
macro index T "<modify-labels>+todo\n"
#macro index I "<modify-labels>-inbox -unread\\n"                 # removed from inbox
#macro index S "<modify-labels-then-hide>-inbox -unread +junk\\n" # tag as Junk mail

# quick jump between boxes
macro index gi "<change-vfolder> Inbox<enter>" "Go to Inbox"
macro index gu "<change-vfolder> Unread<enter>" "Go to Unread"
macro index ga "<change-vfolder> Archive<enter>" "Go to Archive"
macro index gs "<change-vfolder> Sent<enter>" "Go to Sent Mail"
macro index gd "<change-vfolder> Drafts<enter>" "Go to Drafts"
macro index gt "<change-vfolder> Todo<enter>" "Go to Drafts"

auto_view text/html                                      # view html automatically
auto_view text/calendar                                  # view ics automatically
alternative_order text/plain text/enriched text/html     # save html for last

# theme
source ~/.mutt/solarized-dark-16.muttrc
#folder-hook ! archive "color index red default \"~Y '\W?archive\W?'\""
